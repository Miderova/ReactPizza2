import React from "react";
import styles from "./Search.module.scss";
import { SearchContext } from "../../App";
import debounce from "lodash.debounce";

const Search = () => {
  const [value, setValue] = React.useState("");
  const { setSearchValue } = React.useContext(SearchContext);
  const inputRef = React.useRef();

  const onClickClear = () => {
    setSearchValue("");
    setValue("");
    inputRef.current.focus();
  };

  const updateSearchValue = React.useCallback(
    debounce((str) => {
      setSearchValue(str);
    }, 300),
    []
  );

  const onChangeInput = (event) => {
    setValue(event.target.value);
    updateSearchValue(event.target.value);
  };

  return (
    <div className={styles.root}>
      <svg
        className={styles.icon}
        width="30"
        height="30"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M18.6511 8.85998C18.689 8.80286 18.738 8.75382 18.795 8.71569C18.852 8.67755 18.916 8.65108 18.9833 8.63779C19.0506 8.62449 19.1199 8.62465 19.1871 8.63824C19.2543 8.65183 19.3182 8.67859 19.3751 8.71698C20.0442 9.16533 20.5276 9.84167 20.7351 10.62C20.7551 10.6869 20.7616 10.7572 20.754 10.8266C20.7465 10.8961 20.725 10.9633 20.691 11.0243C20.657 11.0853 20.611 11.1389 20.5559 11.1818C20.5008 11.2247 20.4376 11.2562 20.3702 11.2743C20.3027 11.2923 20.2322 11.2967 20.1631 11.287C20.0939 11.2774 20.0273 11.254 19.9673 11.2181C19.9074 11.1823 19.8552 11.1348 19.8139 11.0784C19.7727 11.0221 19.7431 10.958 19.7271 10.89C19.5846 10.356 19.2531 9.89184 18.7941 9.58398C18.7369 9.546 18.6879 9.49708 18.6498 9.44006C18.6116 9.38304 18.5852 9.31904 18.5719 9.25175C18.5586 9.18445 18.5587 9.11519 18.5723 9.04795C18.5859 8.98071 18.6127 8.91683 18.6511 8.85998Z"
          fill="black"
        />
        <path
          d="M21.395 7.60503C20.386 6.56719 19.0074 5.97062 17.5601 5.94553C16.1129 5.92044 14.7144 6.46887 13.6701 7.47112C12.6257 8.47337 12.0202 9.84806 11.9857 11.2951C11.9512 12.7422 12.4905 14.1442 13.486 15.195L11.613 17.536C11.5468 17.6161 11.4971 17.7085 11.4669 17.8079C11.4367 17.9073 11.4266 18.0117 11.4372 18.115C11.4478 18.2184 11.4788 18.3186 11.5285 18.4098C11.5782 18.501 11.6455 18.5815 11.7266 18.6464C11.8077 18.7114 11.9008 18.7595 12.0007 18.7881C12.1006 18.8167 12.2052 18.8251 12.3083 18.8129C12.4115 18.8007 12.5112 18.768 12.6016 18.7169C12.692 18.6658 12.7714 18.5971 12.835 18.515L14.7 16.185C15.8476 16.8699 17.2058 17.1121 18.5194 16.8662C19.833 16.6202 21.0116 15.9031 21.8337 14.8495C22.6559 13.7958 23.065 12.4783 22.9842 11.1443C22.9034 9.8103 22.3383 8.55173 21.395 7.60503ZM14.75 8.71303C15.1136 8.34947 15.5452 8.06107 16.0202 7.86431C16.4952 7.66755 17.0043 7.56628 17.5185 7.56628C18.0327 7.56628 18.5418 7.66755 19.0168 7.86431C19.4918 8.06107 19.9234 8.34947 20.287 8.71303C20.6506 9.0766 20.939 9.50821 21.1357 9.98323C21.3325 10.4583 21.4338 10.9674 21.4338 11.4815C21.4338 11.9957 21.3325 12.5048 21.1357 12.9798C20.939 13.4549 20.6506 13.8865 20.287 14.25C19.5527 14.9843 18.5569 15.3968 17.5185 15.3968C16.4801 15.3968 15.4843 14.9843 14.75 14.25C14.0157 13.5158 13.6032 12.5199 13.6032 11.4815C13.6032 10.4431 14.0157 9.44729 14.75 8.71303ZM1 11.761C1 10.7227 1.41247 9.72692 2.14668 8.99271C2.88088 8.25851 3.87668 7.84603 4.915 7.84603H11.18C11.3877 7.84603 11.5868 7.92853 11.7337 8.07537C11.8805 8.22221 11.963 8.42137 11.963 8.62903C11.963 8.8367 11.8805 9.03586 11.7337 9.1827C11.5868 9.32954 11.3877 9.41203 11.18 9.41203H4.915C4.30387 9.42987 3.72375 9.68517 3.29779 10.1237C2.87182 10.5623 2.63355 11.1496 2.63355 11.761C2.63355 12.3724 2.87182 12.9597 3.29779 13.3983C3.72375 13.8369 4.30387 14.0922 4.915 14.11H9.092C9.29966 14.11 9.49882 14.1925 9.64566 14.3394C9.79251 14.4862 9.875 14.6854 9.875 14.893C9.875 15.1007 9.79251 15.2999 9.64566 15.4467C9.49882 15.5935 9.29966 15.676 9.092 15.676H4.915C3.87668 15.676 2.88088 15.2636 2.14668 14.5294C1.41247 13.7952 1 12.7994 1 11.761Z"
          fill="black"
        />
        <path
          d="M4.39307 11.761C4.39307 11.473 4.62707 11.239 4.91507 11.239H9.61407C9.75251 11.239 9.88529 11.294 9.98318 11.3919C10.0811 11.4898 10.1361 11.6226 10.1361 11.761C10.1361 11.8995 10.0811 12.0322 9.98318 12.1301C9.88529 12.228 9.75251 12.283 9.61407 12.283H4.91507C4.84645 12.2833 4.77845 12.27 4.715 12.2438C4.65155 12.2177 4.5939 12.1792 4.54537 12.1307C4.49685 12.0822 4.45841 12.0245 4.43227 11.9611C4.40613 11.8976 4.39281 11.8296 4.39307 11.761Z"
          fill="black"
        />
      </svg>

      <input
        ref={inputRef}
        value={value}
        onChange={onChangeInput}
        className={styles.input}
        placeholder="Поиск пиццы.."
      />
      {value && (
        <svg
          onClick={onClickClear}
          className={styles.close}
          width="20"
          height="20"
          viewBox="0 0 20 20"
          fill="rgba(255, 123, 0, 0.479)"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path d="M10 1.25C5.125 1.25 1.25 5.125 1.25 10C1.25 14.875 5.125 18.75 10 18.75C14.875 18.75 18.75 14.875 18.75 10C18.75 5.125 14.875 1.25 10 1.25ZM13.375 14.375L10 11L6.625 14.375L5.625 13.375L9 10L5.625 6.625L6.625 5.625L10 9L13.375 5.625L14.375 6.625L11 10L14.375 13.375L13.375 14.375Z" />
        </svg>
      )}
    </div>
  );
};

export default Search;
